<!DOCTYPE html>
<html lang="pt-PT">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Login - FEKA KAWIÇO</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f4f6f8;margin:0;padding:0;color:#333;display:flex;justify-content:center;align-items:center;height:100vh}
.card{background:#fff;padding:22px;border-radius:8px;border:1px solid #ddd;width:360px;box-shadow:0 8px 30px rgba(0,0,0,0.06)}
input{width:100%;padding:10px;margin-top:10px;border-radius:6px;border:1px solid #ccc}
button{background:#0055a5;color:#fff;padding:10px;border:0;border-radius:6px;margin-top:12px;cursor:pointer;transition:background 0.3s;}
button:hover{background:#00407a}
.link{display:block;margin-top:10px;color:#0055a5;text-decoration:none}
.msg{display:none;padding:8px;border-radius:6px;margin-top:8px;text-align:center;font-weight:bold;}
.msg.error{background:#ffe0e0;color:#a00000}
.msg.success{background:#e0ffe0;color:#006600}
</style>
</head>
<body>
<div class="card">
  <h3>Entrar na FEKA KAWIÇO</h3>
  <form id="loginForm">
    <input id="username" placeholder="Username" required> 
    <input id="password" type="password" placeholder="Password" required>
    <button type="submit">Entrar</button>
  </form>
  <a class="link" href="Inscricaogeral.html">Ainda não tens conta? Inscrever-me</a>
  <a class="link" href="trocarpass.html">Esqueci a password / Trocar</a>

  <div id="msgErr" class="msg error"></div>
</div>

<script>
document.getElementById('loginForm').addEventListener('submit', e => {
    e.preventDefault();
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    const msgErr = document.getElementById('msgErr');
    
    // Esconde a mensagem de erro anterior
    msgErr.style.display = 'none'; 
    msgErr.classList.remove('error', 'success');
    
    // Função para carregar inscritos do localStorage (chave usada pela Inscricaogeral.html)
    function getInscritos() {
        try {
            return JSON.parse(localStorage.getItem('inscritos_feka')) || [];
        } catch (e) {
            console.error("Erro ao ler localStorage:", e);
            return [];
        }
    }
    
    const inscritos = getInscritos();

    // 1. Procurar o utilizador que corresponda ao username E password
    const user = inscritos.find(u => u.username === username && u.password === password);

    if (user) {
        // 2. Login bem-sucedido
        // Criar objeto de sessão (removendo a password)
        const userSession = { ...user };
        delete userSession.password; 
        
        // 3. Guardar sessão simples no localStorage (simulando a sessão)
        localStorage.setItem('feka_user', JSON.stringify(userSession));
        
        msgErr.textContent = `Login efetuado com sucesso! Bem-vindo, ${user.nome.split(' ')[0]}.`;
        msgErr.classList.add('success');
        msgErr.style.display = 'block';

        // 4. Redirecionar após 1 segundo
        setTimeout(() => {
            // Redireciona para a página principal (index.html)
            location.href = 'index.html';
        }, 1000); 

    } else {
        // 5. Credenciais inválidas
        msgErr.textContent = 'Credenciais inválidas. Verifique o Username e a Password.';
        msgErr.classList.add('error');
        msgErr.style.display = 'block';
    }
});
</script>
</body>
</html>