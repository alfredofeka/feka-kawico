<!DOCTYPE html>
<html lang="pt-PT">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FEKA KAWIÇO | Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
  body {font-family:'Inter',sans-serif;margin:0;background:#eef2f7;color:#333;}
  header {background:#004a80;color:white;padding:15px 30px;display:flex;justify-content:space-between;align-items:center;}
  header a {color:white;text-decoration:none;font-weight:bold;}
  .container {display:flex;min-height:calc(100vh - 60px);}
  .sidebar {width:250px;background:#fff;box-shadow:2px 0 5px rgba(0,0,0,0.05);padding:20px;transition:width 0.3s;}
  .sidebar.collapsed {width:60px;}
  .sidebar h2 {margin-top:0;color:#004a80;font-size:18px;}
  .sidebar ul{list-style:none;padding:0;margin:0;}
  .sidebar li{margin-bottom:10px;cursor:pointer;color:#007bff;}
  .sidebar li:hover{text-decoration:underline;}
  .main {flex:1;padding:30px;}
  h1{color:#004a80;}
  .course-card{background:white;padding:20px;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,0.1);margin-bottom:20px;}
  .progress-bar{height:18px;border-radius:8px;background:#ccc;margin-top:8px;overflow:hidden;}
  .progress-fill{height:100%;background:#28a745;width:0%;transition:width 0.3s;}
  table{width:100%;border-collapse:collapse;margin-top:15px;}
  table th, table td{border:1px solid #ccc;padding:8px;text-align:left;}
  .btn{background:#007bff;color:white;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;}
  .btn:hover{opacity:0.9;}
  .toggle-sidebar{position:absolute;top:20px;right:-25px;background:#007bff;width:25px;height:25px;border-radius:50%;color:white;font-weight:bold;text-align:center;line-height:25px;cursor:pointer;}
</style>
</head>
<body>

<header>
  <div>FEKA KAWIÇO Dashboard</div>
  <div id="userHeader"></div>
</header>

<div class="container">
  <div class="sidebar" id="sidebar">
    <div class="toggle-sidebar" onclick="toggleSidebar()">&#9776;</div>
    <h2>Cursos</h2>
    <ul id="sidebarCourses"></ul>
    <div id="formadorPanel" style="margin-top:30px;display:none;">
      <h2>Formador</h2>
      <ul>
        <li onclick="verAlunos()">Alunos & Progresso</li>
      </ul>
    </div>
  </div>
  
  <div class="main">
    <h1>Bem-vindo, <span id="userName"></span></h1>
    <div id="courseContent"></div>
    <div id="formadorContent"></div>
  </div>
</div>

<script>
// ----- Dados iniciais -----
const CODIGOS_VALIDOS = {
  procurement: ["PRC-2025-001","PRC-2025-002"],
  ingles: ["ING-2025-001","ING-2025-002"],
  frances: ["FRA-2025-001"]
};
const CURSOS = [
  {key:'procurement', nome:'Procurement', descricao:'Estruturas metálicas'},
  {key:'ingles', nome:'Inglês Técnico', descricao:'Inglês aplicado a engenharia'},
  {key:'frances', nome:'Francês Técnico', descricao:'Francês aplicado a engenharia'}
];

// ----- Usuário -----
let user = JSON.parse(localStorage.getItem('feka_user') || 'null');
if(!user){ alert('Tens que fazer login!'); location.href='login.html'; }
document.getElementById('userHeader').innerHTML=`<span>Olá, ${user.nome.split(' ')[0]}</span> <button class="btn" onclick="logout()">Sair</button>`;
document.getElementById('userName').textContent=user.nome.split(' ')[0];

// ----- Sidebar -----
function toggleSidebar(){
  document.getElementById('sidebar').classList.toggle('collapsed');
}
const sidebarCourses = document.getElementById('sidebarCourses');
CURSOS.forEach(c=>{
  const li=document.createElement('li');
  li.textContent=c.nome;
  li.onclick=()=>abrirCurso(c.key);
  sidebarCourses.appendChild(li);
});

// ----- Dashboard -----
function abrirCurso(cursoKey){
  const courseContent = document.getElementById('courseContent');
  const validado = localStorage.getItem(`${cursoKey}_validado`)==='true';
  courseContent.innerHTML='';
  const curso = CURSOS.find(c=>c.key===cursoKey);
  if(!validado){
    // mostrar input de validação
    const div=document.createElement('div');
    div.innerHTML=`<div class="course-card">
      <h3>${curso.nome}</h3>
      <p>${curso.descricao}</p>
      <input type="text" id="codeInput_${cursoKey}" placeholder="Código de inscrição">
      <button class="btn" onclick="validarCodigo('${cursoKey}')">Validar Código</button>
      <div id="msg_${cursoKey}" style="margin-top:10px;font-weight:bold;"></div>
    </div>`;
    courseContent.appendChild(div);
  } else {
    mostrarProgresso(cursoKey);
  }
}

function validarCodigo(cursoKey){
  const input = document.getElementById(`codeInput_${cursoKey}`).value.trim().toUpperCase();
  const msg = document.getElementById(`msg_${cursoKey}`);
  if(CODIGOS_VALIDOS[cursoKey].includes(input)){
    localStorage.setItem(`${cursoKey}_validado`,'true');
    if(!user.progresso) user.progresso={};
    if(!user.progresso[cursoKey]) user.progresso[cursoKey]=0;
    localStorage.setItem('feka_user',JSON.stringify(user));
    msg.style.color='green';
    msg.textContent='✅ Código válido! Curso desbloqueado.';
    setTimeout(()=>abrirCurso(cursoKey),500);
  } else{
    msg.style.color='red';
    msg.textContent='❌ Código inválido.';
  }
}

// ----- Progresso -----
function mostrarProgresso(cursoKey){
  const courseContent = document.getElementById('courseContent');
  const progresso = user.progresso && user.progresso[cursoKey]? user.progresso[cursoKey]:0;
  const curso = CURSOS.find(c=>c.key===cursoKey);
  courseContent.innerHTML=`<div class="course-card">
    <h3>${curso.nome}</h3>
    <p>${curso.descricao}</p>
    <div class="progress-bar"><div class="progress-fill" style="width:${progresso}%"></div></div>
    <p>${progresso}% completado</p>
    <button class="btn" onclick="avancar('${cursoKey}')">Avançar +10%</button>
  </div>`;
}

function avancar(cursoKey){
  if(!user.progresso) user.progresso={};
  if(!user.progresso[cursoKey]) user.progresso[cursoKey]=0;
  user.progresso[cursoKey] = Math.min(user.progresso[cursoKey]+10,100);
  localStorage.setItem('feka_user',JSON.stringify(user));
  mostrarProgresso(cursoKey);
}

// ----- Formador -----
if(user.role==='formador'){
  document.getElementById('formadorPanel').style.display='block';
}
function verAlunos(){
  const formadorContent = document.getElementById('formadorContent');
  const inscritos = JSON.parse(localStorage.getItem('inscritos_feka')||'[]');
  if(inscritos.length===0){ formadorContent.innerHTML='<p>Nenhum aluno inscrito.</p>'; return; }
  let html=`<h2>Alunos & Progresso</h2><table><tr><th>Nome</th><th>Curso</th><th>Progresso</th></tr>`;
  inscritos.forEach(u=>{
    for(const c in u.progresso){
      html+=`<tr><td>${u.nome}</td><td>${c}</td><td>${u.progresso[c]}%</td></tr>`;
    }
  });
  html+='</table>';
  formadorContent.innerHTML=html;
}

// ----- Logout -----
function logout(){
  if(confirm('Sair?')){ localStorage.removeItem(USER_KEY); location.href='login.html'; }
}

// ----- Inicialização -----
CURSOS.forEach(c=>{if(!localStorage.getItem(`${c.key}_validado`)) localStorage.setItem(`${c.key}_validado`,'false');});
</script>
</body>
</html>
